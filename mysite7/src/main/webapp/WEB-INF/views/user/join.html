<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:spring="http://www.springframework.org/tags">
<head>
    <title>mysite</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <link th:href="@{/assets/css/user.css}" rel="stylesheet" type="text/css">
    <script th:src="@{/assets/js/jquery/jquery-1.9.0.js}"></script>
    <script type="text/javascript">
        $(function() {
            $("#btn-check").click(function() {
                var email = $("#email").val();
                if(email == '') {
                    return;
                }
                
                $.ajax({
                    url: /*[[@{/user/api/checkemail}]]*/ + "?email=" + email,
                    type: "get",
                    dataType: "json",
                    error: function(xhr, status, err){
                        console.error(err);            
                    },
                    success: function(response) {
                        if(response.result == "fail") {
                            console.error(response.message);
                            return;
                        }
                        
                        if(response.data) {
                            alert("존재하는 이메일입니다. 다른 이메일을 사용해 주세요.");
                            $("#email").val("");
                            $("#email").focus();
                            return;
                        }
                        
                        // 사용할 수 있는 이메일
                        $("#btn-check").hide();
                        $("#img-check").show();
                    }
                });
            });
        });
    </script>
</head>
<body>
<div id="container">
    <div th:replace="/WEB-INF/views/includes/header :: header"></div>
    <div id="content">
        <div id="user">
            <form th:action="@{/user/join}" method="post" th:object="${userVo}" id="join-form" name="joinForm">
                <label class="block-label" for="name">이름</label>
                <input type="text" id="name" name="name" th:field="*{name}">
                <p style="color:#f00; text-align:left; padding:0">
                    <spring:hasBindErrors name="userVo">
                        <c:if test="${#fields.hasErrors('name')}">
                            <span th:text="${#fields.errors('name')}"></span>
                        </c:if>
                    </spring:hasBindErrors>
                </p>
                
                <label class="block-label" for="email">이메일</label>
                <input type="text" id="email" name="email" th:field="*{email}">
                <input type="button" id="btn-check" value="이메일확인">
                <img id="img-check" th:src="@{/assets/images/check.png}" style="vertical-align:bottom; width:24px; display: none">
                <p style="color:#f00; text-align:left; padding:0">
                    <spring:errors path="email"></spring:errors>
                </p>                    
                    
                <label class="block-label"><spring:message code="user.join.label.password" /></label>
                <input type="password" id="password" name="password" th:field="*{password}">
                <p style="color:#f00; text-align:left; padding:0">
                    <spring:errors path="password"></spring:errors>
                </p>
                    
                <fieldset>
                    <legend>성별</legend>
                    <input type="radio" id="female" name="gender" th:field="*{gender}" value="female" checked="checked">
                    <label for="female">여</label>
                    <input type="radio" id="male" name="gender" th:field="*{gender}" value="male">
                    <label for="male">남</label>
                </fieldset>
                
                <fieldset>
                    <legend>약관동의</legend>
                    <input type="checkbox" id="agree-prov" name="agreeProv" th:field="*{agreeProv}" value="y">
                    <label for="agree-prov">서비스 약관에 동의합니다.</label>
                </fieldset>
                
                <input type="submit" value="가입하기">       
            </form>
        </div>
    </div>
    <div th:replace="/WEB-INF/views/includes/navigation :: navigation"></div>
    <div th:replace="/WEB-INF/views/includes/footer :: footer"></div>
</div>
</body>
</html>